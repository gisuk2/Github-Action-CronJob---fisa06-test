name: Data Collection Pipeline

on:
  schedule:
    - cron: '*/5 * * * *' # 5분마다 실행
  workflow_dispatch:      # 수동 실행 허용 (이벤트 발생 시 호출 조건 충족)

jobs:
  collect_data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Calculate Todo ID and Fetch Data
        run: |
          # 1. 현재 분 계산 및 ID 설정 (현재 분 + 1)
          CURRENT_MIN=$(date +%M)
          # 00분일 경우 1이 되도록 10진수 처리(08, 09분 오류 방지)
          TODO_ID=$((10#$CURRENT_MIN + 1))
          
          echo "Fetching Todo ID: $TODO_ID"
          
          # 2. API 호출 및 파일에 추가 (Incremental Update)
          # 파일이 없으면 생성, 있으면 아래에 추가하도록 >> 연산자 사용
          # JSON 형식 유지를 위해 간단한 리스트 형태로 저장하거나 줄바꿈으로 구분
          curl -s "https://jsonplaceholder.typicode.com/todos/$TODO_ID" >> "신은욱_test.json"
          echo "" >> "신은욱_test.json" # 데이터 간 구분을 위한 줄바꿈

      - name: Commit and Push changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add "신은욱_test.json"
          git commit -m "Update data: Todo ID $TODO_ID"
          git push